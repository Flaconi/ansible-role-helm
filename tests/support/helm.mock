#!/usr/bin/env bash

# Mock Helm binary
# If certain commands were called exit with successful code


HELM_VERSION="${HELM_VERSION:-2.12.3}"
HELM_KUBECTL_CONTEXT="${HELM_KUBECTL_CONTEXT:-}"
EXTRA_PARAMS=

if [ -n "${HELM_KUBECTL_CONTEXT}" ]; then
	EXTRA_PARAMS="--kube-context ${HELM_KUBECTL_CONTEXT} "
fi

arguments=$(printf "%s" "${*}")

upgrade_prometheus_flags="upgrade ${EXTRA_PARAMS}--version 8.8.0 --namespace prometheus --values /etc/ansible/roles/rolename/tests/helm-config/prometheus/values.yml prometheus stable/prometheus"
install_logstash_flags="install stable/logstash ${EXTRA_PARAMS}--version 8.8.0 --namespace logstash --values /etc/ansible/roles/rolename/tests/helm-config/logstash/values.yml --name logstash"

if [ "${arguments}" = "version --client --template '{{ .Client.SemVer }}'" ] || \
  [ "${arguments}" = "version --client --template {{ .Client.SemVer }}" ]; then
  echo "v${HELM_VERSION}"
elif [ "${arguments}" = "init ${EXTRA_PARAMS}--upgrade" ]; then
  exit 0
elif [ "${arguments}" = "init ${EXTRA_PARAMS}--client-only" ]; then
  exit 0
elif [ "${arguments} " = "repo update ${EXTRA_PARAMS}" ]; then
  exit 0
elif [ "${arguments}" = "list ${EXTRA_PARAMS}--all --output yaml" ]; then
  # helm list --all --output yaml
  cat << EOF
Next: ""
Releases:
- AppVersion: 2.7.1
  Chart: prometheus-8.8.0
  Name: prometheus
  Namespace: prometheus
  Revision: 1
  Status: DEPLOYED
  Updated: Wed Mar 03 06:36:33 2018
EOF
elif [ "${arguments}" = "${upgrade_prometheus_flags}" ]; then
  exit 0
elif [ "${arguments}" = "${install_logstash_flags}" ]; then
  exit 0
else
  echo "${arguments}"
  exit 1
fi
